<!DOCTYPE html>
<html>
	<head>
		<title>Tutorial MD</title>
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-137823758-1"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-137823758-1');
		</script>
	</head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="./wcss.css">
	<body>
		<div class="Content TopMargin" style="max-width:1400px;">
			<div class="RowPadding">
				<div class="w3-third">
					<div class="BackWhite TextGrey">
						<div class="Container1">
							<a href="./index.html"><p class="Large"><b>Simon Gravelle</b></p></a>
							<p>
								<a TARGET="_BLANK" href="https://www.sems.qmul.ac.uk/staff/s.gravelle">Postdoctoral researcher <br>
								University Queen Mary <br>
								London, UK</a>
							</p>
							<p>
								simon.gravelle at live.fr <br>
								s.gravelle at qmul.ac.uk
							</p>

							<a href="./index.html"><img src="./Images/simon_gravelle_UAI.jpg" style="width:100%" alt="Picture"></a>

							<p class="Large2"><b>Interests</b></p>
							<p>
								<a TARGET="_BLANK" href="https://en.wikipedia.org/wiki/Biomimetics">Biomimetics </a><br>
								<a TARGET="_BLANK" href="https://en.wikipedia.org/wiki/Nanofluidics">Nanofluidics </a><br>
								<a TARGET="_BLANK" href="https://en.wikipedia.org/wiki/Thermodynamics">Thermodynamics </a><br>
								Cytoskeleton dynamics <br>
								Fluid-solid interaction <br>
								Flow through porous media <br>
							</p>
							
							<p class="Large2"><b>Expertise</b></p>
							<p>
								<a TARGET="_BLANK" href="https://en.wikipedia.org/wiki/Molecular_dynamics">Molecular dynamics </a><br>
								<a TARGET="_BLANK" href="https://en.wikipedia.org/wiki/Finite_element_method">Finite elements method </a><br>
								<a TARGET="_BLANK" href="https://en.wikipedia.org/wiki/Monte_Carlo_method">Grand canonical Monte Carlo </a><br>
								<a TARGET="_BLANK" href="https://en.wikipedia.org/wiki/Umbrella_sampling">Umbrella sampling </a><br>
								<a TARGET="_BLANK" href="https://en.wikipedia.org/wiki/Fluorescence_correlation_spectroscopy">F. C. Spectroscopy</a>
							</p>
							
							<p class="Large2"><b>Career</b></p>
							<p>
							since 2019 - Postdoc n°2 <br>
							<a TARGET="_BLANK" href="https://www.qmul.ac.uk/">QMUL, London, UK</a> <br> <br>
							2016-2019 - Postdoc n°1 <br>
							<a TARGET="_BLANK" href="https://www.uai.cl/campus-uai/campus-vina-del-mar/"> UAI, Viña del Mar, Chile</a> <br>
							<a TARGET="_BLANK" href="https://www.conicyt.cl/fondecyt/category/concursos/postdoctorado/"> Scholarship Fondecyt Postdoc</a> <br> <br>
							2012-2015 - PhD thesis <br>
							<a TARGET="_BLANK" href="https://www.univ-lyon1.fr/"> UCB, Lyon, France </a>
							</p>
							
							<p class="Large2"><b>Resume (<a TARGET="_BLANK" href="SimonGravelle_resume.pdf">download pdf</a>)</b></p>
							<p>
								<a TARGET="_BLANK" href="https://scholar.google.com/citations?user=9fD2JlYAAAAJ&hl=en">
								8 publi (including PNAS, PRL) <br>
								more than 250 citations <br>
								h-factor=6</a>
							</p>

						</div>
					</div>
	    			</div>
				<div class="Twothird">
					<div class="Container1 BackWhite MarginBottom">
						<div class="clearfix Container7">
							<a href="./index.html"><p class="Large"><b>Back to the index</b></p></a>
						</div>
					</div>
					<div class="Container1 BackWhite MarginBottom">
						<div class="clearfix Container5">
							<p class="Large"><b>Step-by-step tutorial &mdash; molecular dynamics for absolute beginners</b></p>

							<p align="justify">In order to follow this step-by-step tutorial, you need to download <a TARGET="_BLANK" href="https://lammps.sandia.gov/">LAMMPS</a>, which is an open source classical molecular dynamics code. You also need a text editor, a molecular visualisation program, such as <a TARGET="_BLANK" href="https://www.ks.uiuc.edu/Research/vmd/">VMD</a>, and a data plotting program, such as <a TARGET="_BLANK" href="http://exciting-code.org/xmgrace-quickstart">Xmgrace</a>. Finally, I use Python to generate the initial configuration.
							</p>
							<br>
							<p class="Large"><b>Step 1 &mdash; data file generation</b></p>
							<p align="justify">Before running the simulation, we need to generate a file containing the initial positions of atoms. For the force field we use here (TIP4P/2005), we also need to which atoms are bonded together (O-H bond), and which atoms are constrained by an angle (H-O-H). I am using Python to generate this initial configuration file, but you can use another programming language and get the exact same result.</p>

							<p align="justify">First we open an empty text file, name it "systemgeneration.py", and import mathematical functions.</p>

							<div class="ContainerCode">from math import *</div>

							<p align="justify">Then we define the water molecule parameters,<p>

							<div class="ContainerCode">
							typat=2; <span class="comment"># 2 types of atom in total (hydrogen and oxygen)</span> <br>
							typbo=1; <span class="comment"># 1 type of bond (O-H)</span> <br>
							typan=1; <span class="comment"># 1 type of angle (H-O-H)</span> <br> 
							mH=1.00794; <span class="comment"># hydrogen mass in grams per mole</span> <br>
							mO=15.9994; <span class="comment"># oxygen mass in grams per mole</span> <br>
							alpha=104.5*pi/180; <span class="comment"># O-H-O angle (TIP4P/2005) in radian</span> <br>
							r=0.9584; <span class="comment"># O-H bond distance (TIP4P/2005) in angstrom</span> <br>
							qO=-1.1128; <span class="comment"># oxygen charge (TIP4P/2005) in multiple of electron charge</span> <br>
							qH=0.5564; <span class="comment"># hydrogen charge (TIP4P/2005) in multiple of electron charge</span> <br>
							dOO=3.1589; <span class="comment"># typical O-O distance in angstrom</span> <br>
							</div> 
							<p align="justify">the box initial dimensions,<p>
							<div class="ContainerCode">
							txlo=-15; txhi=15;<br>
							tylo=-15; tyhi=15;<br>
							tzlo=-15; tzhi=15;<br>
							</div> 
							<p align="justify">and initiate a few counters. <p>
							<div class="ContainerCode">
							cptAtom=0; <span class="comment"># for atom counting</span> <br>
							cptBond=0; <span class="comment"># for bond counting</span> <br>
							cptAngle=0; <span class="comment"># for angle counting</span> <br>
							cptMolecule=0; <span class="comment"># for molecule counting</span> <br>
							</div> 
							<p align="justify">Then, I open a temporary file in which I write informations needed by LAMMPS, such as box dimensions, atoms mass,<p>
							<div class="ContainerCode">
								fichier = open("temp", "w") <br>
								fichier.write(str(txlo) + " " + str(txhi) + " xlo xhi \n"); <br>
								fichier.write(str(tylo) + " " + str(tyhi) + " ylo yhi \n"); <br>
								fichier.write(str(tzlo) + " " + str(tzhi) + " zlo zhi \n"); <br>
								fichier.write("\n"); <br>
								fichier.write("Masses \n \n") <br>
								fichier.write("1 " + str(mH) + "\n"); <br>
								fichier.write("2 " + str(mO) + "\n"); <br>
								fichier.write("\n"); <br>
							</div> 
							<p align="justify">atom location (note: be careful with the indentations in python),<p>
							<div class="ContainerCode">
								fichier.write("Atoms \n \n") <br>
								x=txlo+dOO/2;<br>
								y=tylo+dOO/2;<br>
								z=tzlo+dOO/2;<br>
								while x <= txhi-dOO/2:<br>
								&emsp; &emsp; while y <= tyhi-dOO/2:<br>
								&emsp; &emsp; &emsp; &emsp; while z <= tzhi-dOO/2:<br>
								&emsp; &emsp; &emsp; &emsp; &emsp; &emsp; cptMolecule+=1;<br>
								&emsp; &emsp; &emsp; &emsp; &emsp; &emsp; fichier.write(str(cptAtom+1)+" "+str(cptMolecule)+" 2 "+str(qO)+" "+str(x)+" "+str(y)+" "+str(z) + "\n");cptAtom+=1;<br>
								&emsp; &emsp; &emsp; &emsp; &emsp; &emsp; fichier.write(str(cptAtom+1)+" "+str(cptMolecule)+" 1 "+str(qH)+" "+str(r+x)+" "+str(y)+" "+str(z) + "\n");cptAtom+=1;<br>
								&emsp; &emsp; &emsp; &emsp; &emsp; &emsp; fichier.write(str(cptAtom+1)+" "+str(cptMolecule)+" 1 "+str(qH)+" "+str(r*sin(alpha)+x)+ " "+str(r*sin(alpha)+y)+" "+ str(z)+"\n");cptAtom+=1;<br>
								&emsp; &emsp; &emsp; &emsp; &emsp; &emsp; z=z+dOO;<br>
								&emsp; &emsp; &emsp; &emsp; y=y+dOO;<br>
								&emsp; &emsp; &emsp; &emsp; z=tzlo+dOO/2;<br>
								&emsp; &emsp; x=x+dOO;<br>
								&emsp; &emsp; y=tylo+dOO/2;<br>
								fichier.write("\n");<br>
							</div>
							<p align="justify">bond informations,<p>
							<div class="ContainerCode">
							fichier.write("Bonds \n \n") <br>	
							while cptBond < 2*cptAtom/3: <br>		
							&emsp; &emsp;	fichier.write(str(cptBond+1)+" 1 "+str(cptBond/2*3+1)+" "+str(cptBond/2*3+2)+"\n"); <br>	
							&emsp; &emsp;	fichier.write(str(cptBond+2)+" 1 "+str(cptBond/2*3+1)+" "+str(cptBond/2*3+3)+"\n"); <br>	
							&emsp; &emsp;	cptBond+=2;<br>	
							fichier.write("\n");
							</div>
							<p align="justify">and finally angle informations.<p>
							<div class="ContainerCode">
							fichier.write("Angles \n \n")  <br>
							while cptAngle < cptAtom/3: <br>
							&emsp; &emsp;	fichier.write(str(cptAngle+1)+" 1 "+str(cptAngle*3+2)+" "+str(cptAngle*3+1)+" "+str(cptAngle*3+3)+"\n");  <br>
							&emsp; &emsp;	cptAngle+=1;
							</div>
							<p align="justify">Finally, I generate the data file from temporary file.<p>
							<div class="ContainerCode">
								fichier.close() <br>
								source = open("temp", "r") <br>
								txt = source.read() <br>
								source.close() <br>
								import os <br>
								os.remove("temp") <br>
								fichier = open("data.lammps", "w") <br>
								fichier.write("# Data file LAMMPS"+ "\n"+ "\n") <br>
								fichier.write(str(cptAtom)+" "+"atoms"+"\n"); <br>
								fichier.write(str(cptBond)+" "+"bonds"+"\n"); <br>
								fichier.write(str(cptAngle)+" "+"angles"+"\n"); <br>
								fichier.write("\n"); <br>
								fichier.write(str(typat)+" "+"atom types"+"\n"); <br>
								fichier.write(str(typbo)+" "+"bond types"+"\n"); <br>
								fichier.write(str(typan)+" "+"angle types"+"\n"); <br>
								fichier.write("\n"); <br>
								fichier.write(str(txt)); <br>
								fichier.close() <br>
							</div>
							<br>
							You can download directly both python file (<a TARGET="_BLANK" href="tuto1MD/systemgeneration.py">systemgeneration.py</a>) and generated data file (<a TARGET="_BLANK" href="tuto1MD/data.lammps">data.lammps</a>).

							<br><br>

							<p class="Large"><b>Step 2 &mdash; reach the equilibrium </b></p>
							<p align="justify">Now that we have generated a file with the initial positions of the atoms, we need to equilibrate the water at ambient temperature (300 K) and ambient pressure (1 atm). Let us open another empty document, name it "in0", and save it in the same folder as the "data.lammps" file.</p>
							<div class="ContainerCode">
								<span class="comment"># LAMMPS input file</span><br>
							</div>
							<p align="justify">First we need to specify which units we want to use. In our case, "real" is a 								convenient choice. With this choice of units, the distances are in angstrom in agreement with the 								data file previously generated, see <a TARGET="_BLANK" href="https://lammps.sandia.gov/doc/units.html">this page for more details</a>.</p>
							<div class="ContainerCode">
								units           real <br>
							</div>
							<p align="justify">We also set all boundaries as periodic,</p>
							<div class="ContainerCode">
								boundary        p p p <br>
							</div>
							<p align="justify">and use the "full" atom style, as it allows to use bonds, angles, 								dihedrals, impropers and charges.</p>
							<div class="ContainerCode">
								atom_style      full <br>
							</div>	
							<p align="justify">Then, we define the bonds and angles as "harmonic".</p>
							<div class="ContainerCode">
								bond_style      harmonic <br>
								angle_style     harmonic <br>
							</div>	
							<p align="justify">Finally, we specify that the interactions between water molecules are a combination of a Lennard-Jones potential, and Coulombic interactions. Note that since we use the TIP4P water model, which is a bit special because the charge of the oxygen is located at a massless point M, which is different than the position of the oxygen atom, we use the following pair style (see the  <a TARGET="_BLANK" href="https://en.wikipedia.org/wiki/Water_model"> wikipedia page of water models</a>).</p>
							<div class="ContainerCode">
								pair_style	lj/cut/tip4p/long 2 1 1 1 0.1546 10.0 <br>
							</div>	
							<p align="justify">The pair style command indicates that, respectively, the oxygen is the atom type "2", the hydrogen the atom type "1", the bond O-H is the type "1", the angle "H-O-H" is the type "1", distance from O atom to massless charge M is 0.1546 angstrom, and that both LJ and coulombic interactions have a cutoff equal to 10.0 angstroms. Finally, as the long range Coulombic interaction are solved in the reciprocal space, we choose a long range solver. </p>
							<div class="ContainerCode">
								kspace_style	pppm/tip4p 1.0e-4 <br>
							</div>
						</div>
					</div>	
					<div class="Container1 BackWhite MarginBottom">
						<div class="clearfix Container7">
							<a href="./index.html"><p class="Large"><b>Back to the index</b></p></a>
						</div>
					</div>			
				</div>
			</div>
		</div>
	</body>
</html>



















